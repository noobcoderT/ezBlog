{% extends 'blogging/base.html' %}
{% block extrastyle %}
  <link rel="stylesheet" href="/static/libs/editor.md/css/style.css" />
  <link rel="stylesheet" href="/static/libs/editor.md/css/editormd.css" />
{% endblock extrastyle %}
{% block post %}
<div class="pure-u-1">
  <form class="form-horizontal" action="{{url_for('blogging.editor', post_id=post_id or None)}}" method="POST">
      {{ form.hidden_tag() }}
      <fieldset>
          <!-- Form Name -->
          <legend>Blog Editor</legend>
          <!-- Text input-->
          <div class="form-group">
              <label class="control-label col-md-offset-2  control-label input-md" for="title">
                  Title
              </label>
              <div class="input-group col-md-8 col-md-offset-2">
                  {{form.title(placeholder="Title", id="title", class="form-control", required="" )}}
              </div>
          </div>

          <div class="form-group">
              <div id="editormd" class="input-group col-md-8 col-md-offset-2">
                  {{form.text(placeholder="Blog text")}}
                  <span class="help-block">
                      {% if config.BLOGGING_ALLOW_FILEUPLOAD %}
                          <a target="_blank" href="{{ url_for("flask_fileupload.upload") }}">Upload new File</a>
                      {% endif %}
                  </span>
              </div>
          </div>
          <!-- Text input-->
          <div class="form-group">
              <label class="col-md-offset-2 control-label" for="tags">Tags</label>

              <div class="input-group col-md-8 col-md-offset-2">
                  {{form.tags(id="tags", placeholder="Comma separated tags", class="form-control input-md", required="")}}
              </div>
          </div>
          <!-- draft input-->
          <div class="form-group">
              <div class="col-md-offset-2">
                  <label>
                      {{form.draft(id="draft")}} draft?
                  </label>
                  <label>
                      {{form.public(id="public")}} public?
                  </label>
              </div>
          </div>
          <div class="form-group">
              <div class="col-md-offset-2">
                  {{ form.submit(id="submit", class="btn btn-primary") }}
              </div>
          </div>
      </fieldset>
  </form>
</div>
{% endblock post %}

{% block extrajs %}
  <script src="/static/libs/editor.md/js/jquery.min.js"></script>
  <script src="/static/libs/editor.md/js/editormd.min.js"></script>
  <script type="text/javascript">
  var testEditor;
  $(function() {
      $(function(){
          testEditor = editormd("editormd", {
              width: "100%",
              height: 600,
              path : '/static/libs/editor.md/lib/',
              theme : "dark",
              previewTheme : "dark",
              editorTheme : "pastel-on-dark",
              markdown : "",
              codeFold : true,
              //syncScrolling : false,
              saveHTMLToTextarea : true,    // 保存 HTML 到 Textarea
              searchReplace : true,
              //watch : false,                // 关闭实时预览
              htmlDecode : "style,script,iframe|on*",    // 开启HTML标签解析，为了安全性，默认不开启
              //toolbar  : false,             //关闭工具栏
              //previewCodeHighlight : false, // 关闭预览 HTML 的代码块高亮，默认开启
              emoji : true,
              taskList : true,
              tocm            : true,         // Using [TOCM]
              tex : true,                   // 开启科学公式TeX语言支持，默认关闭
              flowChart : true,             // 开启流程图支持，默认关闭
              sequenceDiagram : true,       // 开启时序/序列图支持，默认关闭,
              //dialogLockScreen : false,   // 设置弹出层对话框不锁屏，全局通用，默认为true
              //dialogShowMask : false,     // 设置弹出层对话框显示透明遮罩层，全局通用，默认为true
              //dialogDraggable : false,    // 设置弹出层对话框不可拖动，全局通用，默认为true
              //dialogMaskOpacity : 0.4,    // 设置透明遮罩层的透明度，全局通用，默认值为0.1
              //dialogMaskBgColor : "#000", // 设置透明遮罩层的背景颜色，全局通用，默认为#fff
              imageUpload : true,
              imageFormats : ["jpg", "jpeg", "gif", "png", "bmp", "webp"],
              imageUploadURL : "./php/upload.php",
              onload : function() {
                  console.log('onload', this);
                  //this.fullscreen();
                  //this.unwatch();
                  //this.watch().fullscreen();
                  //this.setMarkdown("#PHP");
                  //this.width("100%");
                  //this.height(480);
                  //this.resize("100%", 640);
              }
          });
      });
  });
  </script>
{% endblock extrajs %}
